<?xml version="1.0" encoding="UTF-8"?>
<jube>
    <parameterset name="sys_module_params">
        <!-- System (automated detection) -->
        <parameter name="system" mode="shell">cat /etc/FZJ/systemname | tr -d '\n'</parameter>
        <!-- Stages (default 2023) -->
        <parameter name="stage" tag="s20">2020</parameter>
        <parameter name="stage" tag="s21">2021</parameter>
        <parameter name="stage" tag="s22">2022</parameter>
        <parameter name="stage" tag="s23| !(s20|s21|s22)">2023</parameter>
        <parameter name="modules" mode="python">"GCC CUDA"</parameter>
    </parameterset>

    <parameterset name="compile_params">
        <parameter name="src_file">stream.cu</parameter>
        <parameter name="src_folder">src/CUDA-Cpp-STREAM</parameter>
        <parameter name="exe_name">stream_cu.exe</parameter>
        <parameter name="arch" mode="python">
        {
            "juwels": "sm_70",
            "juwelsbooster": "sm_80",
            "jurecadc": "sm_80",
            "jusuf": "sm_70"
        }["${system}"]
        </parameter>
        <parameter name="compiler" mode="python">"nvcc"</parameter>
        <parameter name="comp_args" mode="python">
            "-std=c++11 -ccbin=g++ -arch=${arch}"
        </parameter>
    </parameterset>

    <parameterset name="systemParameter" init_with="platform.xml">
        <parameter name="timelimit">00:15:00</parameter>
        <parameter name="executable">compile/${exe_name}</parameter>
        <parameter name="exp" type="int" tag="varySize">10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32</parameter>
        <parameter name="exp" type="int" tag="fixedSize | !varySize">28</parameter>
        <parameter name="size" type="int" mode="python">2**${exp}</parameter>
        <parameter name="blocksize" type="int" mode="python">192</parameter>
        <parameter name="args_exec">-n ${size} -b ${blocksize}</parameter>
        <parameter name="queue" mode="python">
        {
            "juwels": "develgpus",
            "juwelsbooster": "develbooster",
            "jurecadc": "dc-gpu",
            "jusuf": "develgpus"
        }["${system}"]
        </parameter>
        <parameter name="nodes" type="int">1</parameter>
        <parameter name="taskspernode" type="int">1</parameter>
        <parameter name="preprocess">ml Stages/${stage} ${modules};</parameter>
        <parameter name="measurement">time -p</parameter>
        <parameter name="account">jscbenchmark</parameter>
        <parameter name="gres" mode="python">"gpu:1"</parameter>
    </parameterset>
</jube>
